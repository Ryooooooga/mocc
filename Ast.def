#ifndef NODE
#define NODE(name, base)
#endif

#ifndef NODE_END
#define NODE_END()
#endif

#ifndef NODE_MEMBER
#define NODE_MEMBER(T, x)
#endif

#ifndef NODE_MEMBER_F
#define NODE_MEMBER_F(T, x, f) NODE_MEMBER(T, x)
#endif

#ifndef UNARY_OP
#define UNARY_OP(name)
#endif

#ifndef BINARY_OP
#define BINARY_OP(name)
#endif

#ifndef EXPR_NODE
#define EXPR_NODE(name) NODE(name, Expr)
#endif

#ifndef STMT_NODE
#define STMT_NODE(name) NODE(name, Stmt)
#endif

#ifndef DECLARATOR_NODE
#define DECLARATOR_NODE(name) NODE(name, Declarator)
#endif

#ifndef DECL_NODE
#define DECL_NODE(name) NODE(name, Decl)
#endif

// Expressions
EXPR_NODE(Identifier)
    NODE_MEMBER_F(Symbol *, symbol, symbol)
NODE_END()

EXPR_NODE(Integer)
    NODE_MEMBER_F(long long, value, int)
NODE_END()

UNARY_OP(address_of)
UNARY_OP(indirection)

EXPR_NODE(Unary)
    NODE_MEMBER_F(UnaryOp, operator, UnaryOp)
    NODE_MEMBER_F(ExprNode *, operand, Expr)
NODE_END()

BINARY_OP(add)
BINARY_OP(sub)

EXPR_NODE(Binary)
    NODE_MEMBER_F(BinaryOp, operator, BinaryOp)
    NODE_MEMBER_F(ExprNode *, lhs, Expr)
    NODE_MEMBER_F(ExprNode *, rhs, Expr)
NODE_END()

EXPR_NODE(Assign)
    NODE_MEMBER_F(ExprNode *, lhs, Expr)
    NODE_MEMBER_F(ExprNode *, rhs, Expr)
NODE_END()

EXPR_NODE(ImplicitCast)
    NODE_MEMBER_F(ImplicitCastOp, operator, ImplicitCastOp)
    NODE_MEMBER_F(ExprNode *, expression, Expr)
NODE_END()

// Statements
STMT_NODE(Compound)
    NODE_MEMBER_F(Vec(StmtNode) *, statements, Stmts)
NODE_END()

STMT_NODE(Return)
    NODE_MEMBER_F(ExprNode *, return_value, Expr)
NODE_END()

STMT_NODE(Decl)
    NODE_MEMBER_F(Vec(DeclaratorNode) *, declarators, Declarators)
NODE_END()

STMT_NODE(Expr)
    NODE_MEMBER_F(ExprNode *, expression, Expr)
NODE_END()

// Declarator
DECLARATOR_NODE(Direct)
    NODE_MEMBER_F(Symbol *, symbol, symbol)
NODE_END()

DECLARATOR_NODE(Pointer)
    NODE_MEMBER_F(DeclaratorNode *, declarator, Declarator)
NODE_END()

DECLARATOR_NODE(Init)
    NODE_MEMBER_F(DeclaratorNode *, declarator, Declarator)
    NODE_MEMBER_F(ExprNode *, initializer, Expr)
NODE_END()

// Declarations
DECL_NODE(Function)
    NODE_MEMBER_F(DeclaratorNode *, declarator, Declarator)
    NODE_MEMBER_F(StmtNode *, body, Stmt)
    NODE_MEMBER(Vec(Symbol) *, local_variables)
NODE_END()

// Misc
NODE(TranslationUnit, )
    NODE_MEMBER_F(Vec(DeclNode) *, declarations, Decls)
NODE_END()

#undef NODE
#undef NODE_END
#undef NODE_MEMBER
#undef NODE_MEMBER_F
#undef UNARY_OP
#undef BINARY_OP
#undef EXPR_NODE
#undef STMT_NODE
#undef DECLARATOR_NODE
#undef DECL_NODE
